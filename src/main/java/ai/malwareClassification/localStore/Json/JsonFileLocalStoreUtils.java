package ai.malwareClassification.localStore.Json;

import ai.malwareClassification.localStore.FilenameGenerator;
import ai.malwareClassification.service.apiResponseDto.ApiOutput;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;

import java.io.File;
import java.io.IOException;

@Component
@RequiredArgsConstructor
public class JsonFileLocalStoreUtils {

    private final FilenameGenerator filenameGenerator;
    ObjectMapper objectMapper = new ObjectMapper();

    public String save(ApiOutput apiOutput){
        try {
            String reportJson = objectMapper.writeValueAsString(apiOutput);
            String fileName = filenameGenerator.createStoreFileName("");
            String fullPath = "C:/workspace/fileDir/apiReport/"+fileName;
            objectMapper.writeValue(new File(fullPath), reportJson);
            return fileName;
        } catch (JsonProcessingException e) {
            throw new RuntimeException(e);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}
