const $joinForm = document.getElementById('joinForm')

const $usernameInput = document.getElementById('username')
const $passwordInput = document.getElementById('password')
const $departmentInput = document.getElementById('department')
const $roleInput = document.getElementById('role')

const highlightError = ($input, errorMessage) => {
    $input.classList.add("is-invalid")
    $input.nextElementSibling.innerText = errorMessage
}

const clearError = ($input) => {
    $input.classList.remove("is-invalid")
    $input.nextElementSibling.innerText = ""
}


const validateUsername = (username) => {
    const pattern = /^[A-Za-z0-9+]{4,32}$/;
    return pattern.test(String(username));
}

const validatePassword = (password) => {
    const pattern = /^[A-Za-z0-9+]{3,}$/;
    return pattern.test(String(password));
}

const validate = () => {
    const usernameValue = $usernameInput.value
    const passwordValue = $passwordInput.value
    const departmentValue = $departmentInput.value
    const roleValue = $roleInput.value

    clearError($usernameInput)
    clearError($passwordInput)
    clearError($departmentInput)
    clearError($roleInput)

    let errorCount = 0

    if (!validateUsername(usernameValue)) {
        highlightError($usernameInput, '알파벳, 숫자로만 4 ~ 32자로 입력하세요.')
        errorCount += 1
    }

    if (!isUniqueName && errorCount === 0) {
        highlightError($usernameInput, '중복검사를 해주세요')
        errorCount += 1
    }

    if (!validatePassword(passwordValue)) {
        highlightError($passwordInput, '알파벳, 숫자로만 3자이상 입력하세요.')
        errorCount += 1
    }

    if (!departmentValue) {
        highlightError($departmentInput, '골라주세요.')
        errorCount += 1
    }

    if (!roleValue) {
        highlightError($roleInput, '골라주세요.')
        errorCount += 1
    }

    return (errorCount ? false : true)
}

$joinForm.addEventListener('submit', (event) => {
    if (!validate()) {
        event.preventDefault()
    }
})